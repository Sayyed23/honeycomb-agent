<!DOCTYPE html>
<html>
<head>
    <title>Honeypot Session: {{ session.session_id }}</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background-color: #f9f9f9; }
        h1, h2 { color: #333; }
        .header { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: start; }
        .meta p { margin: 5px 0; }
        .badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.9em; }
        .status-ACTIVE { background: #e3f2fd; color: #1976d2; }
        .status-COMPLETED { background: #e8f5e9; color: #388e3c; }
        .status-TERMINATED_SAFETY { background: #ffebee; color: #d32f2f; }
        
        .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        .message-list { display: flex; flex-direction: column; gap: 15px; }
        .message { padding: 15px; border-radius: 12px; max-width: 80%; position: relative; }
        .scammer { align-self: flex-start; background: #fff; border: 1px solid #ffcdd2; border-left: 5px solid #d32f2f; }
        .user { align-self: flex-end; background: #e8f5e9; border: 1px solid #c8e6c9; border-right: 5px solid #388e3c; }
        .timestamp { font-size: 0.75em; color: #777; margin-top: 5px; display: block; }
        
        .entity-tag { display: inline-block; background: #fff8e1; border: 1px solid #ffe082; padding: 2px 6px; border-radius: 4px; margin: 2px; }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>Session Report</h1>
            <p><strong>ID:</strong> {{ session.session_id }}</p>
        </div>
        <div class="meta">
            <p>Status: <span class="badge status-{{ session.status }}">{{ session.status }}</span></p>
            <p>Risk Score: <strong>{{ session.risk_score }}</strong></p>
            <p>Persona: {{ session.persona }}</p>
            <p>Confidence: {{ session.intelligence_confidence }}</p>
        </div>
    </div>

    <div class="section">
        <h2>Extracted Intelligence</h2>
        {% if entities %}
            <div>
            {% for entity in entities %}
                <div class="entity-tag">
                    <strong>{{ entity.entity_type }}</strong>: {{ entity.entity_value }} 
                    <small>({{ entity.confidence }})</small>
                </div>
            {% endfor %}
            </div>
        {% else %}
            <p>No entities extracted.</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>Conversation Log</h2>
        <div class="message-list">
        {% for msg in messages %}
            <div class="message {{ msg.sender }}">
                <strong>{{ msg.sender|upper }}</strong>
                <p>{{ msg.message }}</p>
                <span class="timestamp">{{ msg.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
        {% endfor %}
        </div>
    </div>
</body>
</html>
